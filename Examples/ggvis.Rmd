```{r knitsetup, echo=FALSE, results='hide', warning=FALSE, message=FALSE, cache=FALSE}
opts_knit$set(base.dir='./', fig.path='', out.format='md')
opts_chunk$set(prompt=FALSE, comment='', results='markup')

library(ggvis)
library(knitr)
library(htmltools)
library(htmlwidgets)
library(pipeR)

gitbook_print_ggvis <- function (g){
   g %>>% ( unclass(knit_print(.))[1] ) %>>%
  ( gsub( x = ., pattern = "(<!--)([/]?html_preserve)[.]*-->", replacement = "")  ) %>>%
  HTML
}
```

<script src="../gitbook/plugins/gitbook-plugin-ggvis/lib/jquery/jquery.min.js"></script>
<link href="../gitbook/plugins/gitbook-plugin-ggvis/lib/jquery-ui/css/smoothness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet" />
<script src="../gitbook/plugins/gitbook-plugin-ggvis/lib/jquery-ui/js/jquery-ui-1.10.4.custom.min.js"></script>
<script src="../gitbook/plugins/gitbook-plugin-ggvis/lib/d3/d3.min.js"></script>
<script src="../gitbook/plugins/gitbook-plugin-ggvis/lib/vega/vega.min.js"></script>
<script src="../gitbook/plugins/gitbook-plugin-ggvis/lib/lodash/lodash.min.js"></script>
<script>var lodash = _.noConflict();</script>
<link href="../gitbook/plugins/gitbook-plugin-ggvis/ggvis/css/ggvis.css" rel="stylesheet" />
<script src="../gitbook/plugins/gitbook-plugin-ggvis/ggvis/js/ggvis.js"></script>
<script src="../gitbook/plugins/gitbook-plugin-ggvis/ggvis/js/shiny-ggvis.js"></script>

# ggvis

`ggvis` is designed to work well with pipes since every function returns the modified `ggvis` as an output.  Let's look at a very simple example `ggvis` pipeline using the `Orange` dataset built into R. We will pipe `Orange` into `ggvis` and then pipe the `ggvis` to `layer_lines()` for a simple line chart.


```{r eval = F}
Orange %>>% ggvis( ~age, ~circumference, stroke =~ Tree ) %>>% layer_lines()
```

`Pipe()` also works well with `ggvis`.

```{r eval = F}
Pipe(Orange)$ggvis( ~age, ~circumference, stroke =~ Tree )$layer_lines()
```

```{r echo = F, message = F, results = 'asis'}
Orange %>>% ggvis(~age, ~circumference, stroke =~ Tree ) %>>% layer_lines() %>>%
  gitbook_print_ggvis %>>% cat
```

## Styling `ggvis`

When we prepare a chart for presentation, we usually will want to customize our chart by making various aesthetic changes.  This a great workflow for a pipe.  Let's add a title, clean up our `x` and `y` axes, and sort our legend all in one pipe.

```{r eval = F}
Orange %>>%
  ggvis(~age, ~circumference, stroke =~ Tree ) %>>%
  layer_lines() %>>%
  add_axis("x"
    , title = "Age of Tree"
    , ticks = 6
    , subdivide = 8
    , tick_size_minor = 4
  ) %>>%
  add_axis( "y", title = "Circumference of Trunk (mm)" ) %>>%
  add_legend( "stroke", values = sort(levels(Orange$Tree)) )
```

```{r echo = F,message =F,results = 'asis'}
Orange %>>%
  ggvis(~age, ~circumference, stroke =~ Tree ) %>>%
  layer_lines() %>>%
  add_axis("x"
    , title = "Age of Tree"
    , ticks = 6
    , subdivide = 8
    , tick_size_minor = 4
  ) %>>%
  add_axis( "y", title = "Circumference of Trunk (mm)" ) %>>%
  add_legend( "stroke", values = sort(levels(Orange$Tree)) ) %>>%
  gitbook_print_ggvis %>>% cat
```


